(function($){$.fn.simpleEllipsis=function(options){var settings=$.extend({keepHTML:true,charactersBeforeEllipsis:80,expanderLocation:"right-center",breakWord:true,spaceBeforeEllipsis:false,onClick:function(wrapper){return false}},options);if(!$("textarea.simpleEllipsisHidden").length){$(document.body).append('<textarea class="simpleEllipsisHidden simpleEllipsisHTMLDecodedTextArea"></textarea>')}return this.each(function(){var typeOfElem=$(this).css("display");if(typeOfElem=="block"&&!$(this).hasClass("simpleEllipsisContainer")){var html=$(this).html();var text=$(this).text();html=html.replace(/\s+/g," ").trim();text=text.replace(/\s+/g," ").trim();if(text.length>settings.charactersBeforeEllipsis){$(this).before('<div class="simpleEllipsisContainer"></div>');var wrapperToUse=$(this).prev(".simpleEllipsisContainer");wrapperToUse.html("");jQuery.data(wrapperToUse,"htmloforig",html);jQuery.data(wrapperToUse,"textoforig",text);var textToDisplayWithEllipsis=null;if(settings.keepHTML===true){textToDisplayWithEllipsis=getTextIncludingHTMLToLength(settings.charactersBeforeEllipsis,html)}else{if(settings.breakWord){textToDisplayWithEllipsis=text.substring(0,settings.charactersBeforeEllipsis)}else{characterCountUntilNextSpace=findNextSpaceInVar(text,settings.charactersBeforeEllipsis);textToDisplayWithEllipsis=text.substring(0,settings.charactersBeforeEllipsis+characterCountUntilNextSpace)}}if(settings.spaceBeforeEllipsis===true){if(textToDisplayWithEllipsis[textToDisplayWithEllipsis.length-1]!==" "&&textToDisplayWithEllipsis[textToDisplayWithEllipsis.length-1]!==String.fromCharCode(160)){textToDisplayWithEllipsis+="&nbsp;"}}textToDisplayWithEllipsis+='<span class="simpleEllipsisDotDotDot">&#8230;</span>';jQuery.data(wrapperToUse,"htmlellipsis",textToDisplayWithEllipsis);wrapperToUse.append(textToDisplayWithEllipsis);wrapperToUse.attr("dotdotdot","true");var originalCSSClasses=$(this).attr("class");if(typeof originalCSSClasses!=typeof undefined&&originalCSSClasses!=""&&originalCSSClasses!=null){wrapperToUse.addClass(originalCSSClasses)}$(this).remove();wireAndStyleWrapper(wrapperToUse,settings.expanderLocation)}}});function findNextSpaceInVar(text,startPosition){var lengthToNextSpace=0;var restOfStr=text.substring(startPosition);var positionOfNextSpace=restOfStr.indexOf(" ");if(positionOfNextSpace!=-1){lengthToNextSpace=positionOfNextSpace}return lengthToNextSpace}function getTextIncludingHTMLToLength(length,html){var lengthToGo=length;var countOfGoodMatchedChars=Number(0);html=filterForHTMLEntities(html);var piecesWithHTML=html.split(/(<\/?[^>]+>)/);if(piecesWithHTML.length>1){piecesWithHTML=removeEmptyElementsFromArray(piecesWithHTML);for(var i=0;i<piecesWithHTML.length;i++){var piece=piecesWithHTML[i];if(piece.match(/<\/?[^>]+>/)){lengthToGo+=piece.length}else{countOfGoodMatchedChars+=piece.length}if(countOfGoodMatchedChars>=length){i=piecesWithHTML.length}}}if(settings.breakWord){return html.substring(0,lengthToGo)}else{var positionOfNextSpace=findNextSpaceInVar(html,lengthToGo);return html.substring(0,lengthToGo+positionOfNextSpace)}}function wireAndStyleWrapper(elem,location){$(elem).attr("style","");if(jQuery.isFunction(options.onClick)){$(elem).off().click(function(e){settings.onClick(elem)})}else{$(elem).off().click(function(e){if(typeof $(this).attr("dotdotdot")!=typeof undefined&&$(this).attr("dotdotdot")!=""){if($(this).attr("dotdotdot")=="true"){$(this).attr("dotdotdot","false");if(settings.keepHTML===true){$(this).html(jQuery.data(elem,"htmloforig"))}else{$(this).html(jQuery.data(elem,"textoforig"))}$(this).removeClass("simpleEllipsisExpand").removeClass("simpleEllipsisCollapse").addClass("simpleEllipsisCollapse")}else{$(this).attr("dotdotdot","true");$(this).html(jQuery.data(elem,"htmlellipsis"));$(this).removeClass("simpleEllipsisExpand").removeClass("simpleEllipsisCollapse").addClass("simpleEllipsisExpand")}}});switch(location){default:case"right-center":$(elem).css("padding-right","20px").css("background-position","right center");break;case"left-center":$(elem).css("padding-left","20px").css("background-position","left center");break;case"top-left":$(elem).css("padding-left","20px").css("background-position","left top");break;case"top-right":$(elem).css("padding-right","20px").css("background-position","right top");break;case"bottom-right":$(elem).css("padding-right","20px").css("background-position","right bottom");break;case"bottom-left":$(elem).css("padding-left","20px").css("background-position","left bottom");break}$(elem).removeClass("simpleEllipsisExpand").addClass("simpleEllipsisExpand")}}function removeEmptyElementsFromArray(arr){var newArr=Array();for(var i=0;i<arr.length;i++){if(arr[i]!==""){newArr.push(arr[i])}}return newArr}function filterForHTMLEntities(htmlText){if($(".simpleEllipsisHTMLDecodedTextArea").length){$(".simpleEllipsisHTMLDecodedTextArea")[0].innerHTML=htmlText;return $(".simpleEllipsisHTMLDecodedTextArea")[0].value}return htmlText}}}(jQuery));